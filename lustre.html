<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
 


   
<!--  xhtml format, hw6 (tables) had to use transitional instead of strict dtd.  -->    
<!--
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">


the one below for strict html:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

sttrict xhtml:

-->





<!--  
CSS Class - UCSCX - 2012.07 - Final Project 
Also making it as part of my PSG page remake.

CSS validator: http://jigsaw.w3.org/css-validator/#validate_by_uri
HTML validator: http://validator.w3.org/
-->    
    
<head>
	<title>Sys Admin Pocket Survival Guide</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="psg2.css"                type="text/css" media="screen">
        <link rel="stylesheet" href="psg-table.css"           type="text/css">
        <link rel="stylesheet" href="psg2-links-icons.css"    type="text/css">
        <link rel="stylesheet" href="psg-positioning.css"     type="text/css">
        <link rel="stylesheet" href="psg-print.css" type="text/css" media="print">
</head>

    
<body>
  <div id="fixie"> <!-- add a fixed position example for css final project.   potentially use to place ad, which will appear like a 3rd column on right -->
          <div id="one"   class="skinny"><a href="plug/plug.html"><img src="plug/nema-5-20R-drawing.gif" alt="nema5pic" width="100" height="100"></a></div>
          <div id="two"   class="skinny"><a href="fig/unixoid_hell.gif"><img src="fig/unixoid_hell.gif"  alt="vi-hell"   width="100" height="77" ></a></div>
          <div id="three" class="skinny"><a href="fig/Assistant.gif"><img    src="fig/Assistant.gif"     alt="clippie"   width="100" height="77" ></a></div>
          <div id="four"  class="skinny"><!-- empty for now --></div>
  </div> <!-- closes #fixie -->

    
<div id="wrapper">
  <div id="header">
    <div id="title">Sys Admin Pocket Survival Guide</div>
    <div id="sub-title">A Quick Reference Guide for Sys Admins with Alzeimer :)</div>
  </div> <!-- closes header -->
  
  <div id="navigation">
      <!-- the replace was not inside hightlight area, but whole page, finc and put back some strong and em in doc...-->
   <!--  strong, em, h5, or div are not allowed to be nested inside ul !!  -->
       <div class="azul">Unix</div>
	<ul>
        <li> <a href="sul>.html">Solaris</a></li>
        <li> <a href="linux.html">Linux</a></li>
        <li> <a href="hpux.html">HP-UX</a> and <br>
                <a href="hpux.supl.html">supplement</a></li>
        <li> <a href="aix.html">AIX</a> and <br>
                <a href="aix_cd_catalog.html">AIX CD catalog</a><br></li>
        <li> <a href="irix.html">Irix</a></li>
        <li> <a href="dos.html">Windows</a></li>
        <li> <a href="apple.html">Apple Mac</a></li>
	</ul>

        <div class="azul">Storage</div>
	<ul>
        <li> <a href="netapp.html">NetApp</a></li>
        <li> <a href="emc.html">EMC SAN - Clariion</a></li>
        <li> <a href="emcCelerra.html">EMC NAS - Celerra</a></li>
        <li> <a href="isilon.html">Isilon</a></li>     
        <li> <a href="fs.html">Unix File System</a></li>
	</ul>

        <div class="azul">Big Data</div>
	<ul>
        <li> <a href="lsf.html">LSF, PBS/Torque, LSF.</a></li>
        <li> <a href="mpi.html">MPI, PVM</a></li>
        <li> <a href="sci-file.html">Science File Format/Info</a></li>
        <li><a href="sci-app.html">Sci-App</a></li>
	</ul>
            
      
        <div class="azul">Unix Dev</div>
	<ul>
  	<li><a href="development.html">compilers, etc</a></li>
  	<li><a href="shellScript.txt">sh/bash, csh/tcsh</a></li>
  	<li><a href="awk.txt">AWK</a></li>
  	<li><a href="perl.html">Perl</a></li>
  	<li><a href="python.html">Python</a></li>
  	<li><a href="php.html">PHP</a></li>
  	<li><a href="javascript_eg.html">javascript_eg</a></li>
   	<li>gcc</li>
  	<li><a href="gdb.html">gdb</a></li>
   	<li>java</li>
   	<li>rcs, cvs, p4, subversion</li>
	<li><a href="vi.html">vi</a></li> 
	</ul>

        <div class="azul">Network</div>
	<ul>
        <li> <a href="net.html">Network</a></li>
        <li> <a href="infiniband.html">InfiniBand</a><br></li>
        <li> <a href="acopia.html">Acopia</a></li>
	</ul>

        <div class="azul">Misc</div>
	<ul>
        <li> <a href="ldap.html">LDAP</a><BR></li>
        <li> <a href="admin.html">General Unix Sys Admin </a></li>
        <li> <a href="tool.html">Sys Admin tools and performance tuning</a></li>
        <li> <a href="vnc.html">VNC, X Emulation</a></li>
        <li> <a href="backup.html">Unix backup</a></li>
        <li> <a href="general_unix.html">Generic Unix Commands</a></li>
        <li> <a href="veritas.html">Veritas</a></li>
        <li> <a href="legato.html">Legato Networker</a></li>
        <li> <a href="mysql.html">MySQL</a></li>
        <li> <a href="html.txt">HTML tags</a></li>
        <li> <a href="wiki.html">WiKi tags</a></li>
        <li> <a href="3rdParty">3rd Party and Vendor Docs Cache</a></li>
	</ul>

        <div class="azul">IMHO</div>
	<ul>
        <li> <a href="monitor.html">Network monitoring tool review</a></li>
        <li> <a href="netArch.html">Network Architecture Approaches</a></li>
        <li> <a href="docPlatform.html">Documentation platform</a></li>
	</ul>

        <div class="azul">Prod Review</div>
	<ul>
        <li><a href="termSvr.html">Terminal (Serial Console) Servers</a></li>
        <li><a href="ent_prod.html">Enterprise Products</a></li>
        <li><a href=""></a></li>
        <li> &nbsp; </li>
	</ul>
            
  </div> <!-- closes #navigation -->


  <!-- ########################################################## -->
  <!-- ########################################################## -->
  
  <div id="content">

      <p>
  
  <H2>Lustre</H2>
<p>
A high performance file system that is guaranteed to make you buy Excedrin(TM) by the box load :)
-- high performance, if you can get it to work.
</p>


<H2>Client side</H2>

<H3>Settings</H3>

<PRE>
/etc/fstab ::
10.46.8.150@tcp0:10.46.8.151@tcp0:/lstr2  /mnt/lustre  lustre  defaults,_netdev  0 0


/etc/modprobe.conf ::
options ksocklnd peer_timeout=0
options lnet networks=tcp0(eth0)
# (2nd line is being tested for statbility) :: 
# use eth1 if cluster node is multi-homed, 
# pick nic on same network as storage where mount takes place

</PRE>

<H3>Recommended settings</H3>

<H5>TCP settings, set before mounting lustre</H5>
<PRE>
echo 16777216 > /proc/sys/net/core/wmem_default 
echo 16777216 > /proc/sys/net/core/wmem_max 
echo 16777216 > /proc/sys/net/core/rmem_default 
echo 16777216 > /proc/sys/net/core/rmem_max
echo 4096 87380 16777216 > /proc/sys/net/ipv4/tcp_rmem 
echo 4096 87380 16777216 > /proc/sys/net/ipv4/tcp_wmem 
echo 30000 > /proc/sys/net/core/netdev_max_backlog
ifconfig eth1 txqueuelen ${TXQLEN:-40}
exit 0
</PRE>

<H5>Lustre settings, set after mounting</H5>
<PRE>
for i in /proc/fs/lustre/osc/*/checksums; do echo 0 > $i; done
for i in /proc/fs/lustre/osc/*/max_dirty_mb; do echo 512 > $i; done
for i in /proc/fs/lustre/osc/*/max_rpc*; do echo 32 > $i; done
</PRE>


<H3>Commands</H3>

<pre>
lfs df -h
lctl
</pre>

    
<H3>Linux Performance Cmd</H3>


<PRE>
sudo ethtool eth1		# see nic speed, duplex


# ssh to any compute node (lustre client)
time -p tcpclient 10.46.8.151 50000 100000 -10000

# tcpclient binary optained from lustre server.

</PRE>

<H3>Performance/Tuning</H3>


Lustre is a cluster-based file system.  Striping across multiple servers and disk store is what get most performance.
Typically setup is done so that each file stay w/in a single stripe, but then as different files are created, 
they will end up in different stripe (server).
<BR>
But for really large file and it is accessed by many clients, best performance would be have if such file is actually stripped.
To do this, use the lfs setstripe command.
<BR>
To simplify life, settings are done per directory basis, but lustre apply to files created therein.


<H5>Method Default</H5>

<PRE>

# sequentially create files that are 1G each.
# each file will land on different stripe
# (but each file in one stripe)

mkdir test-default
cd    test-default
for i in 0 1 2 3 4 5 6 7 ; do
  time -p dd if=/dev/zero of=$i.tmp bs=1024k count=1024
done

lfs getstripe * 
# will see that diff file have diff obdidx, 
# which means they are on diff OST servers

# note that the first number is tremendously skewed by caching
# using smaller file size will get even more caching and less indicative of sustained performance
# 1 gbps NIC, wirespeed is about 125 MB/s

</PRE>

<H5>Method 1: stripe w/in single file</H5>

<PRE>

# sequentially create files that are 1G each.
# each file will land on different stripe
# and within each file they will have diff stripe

# setstripe command does this
# -s NUMBER 	: for stripe size, 4194340 = 4MB
# -i -1 	: index of OST where files would go, -1 means any
# -c -1		: client number?  -1 = any random.   good for up to 8 OST, but as OST are added, especialy in imbalance, may need to tweak this.

mkdir test-file-stripe
#lfs   setstripe test-file-stripe -s 4194304 -i -1 -c -1
cd    test-file-stripe
for i in 0 1 2 3 4 5 6 7 ; do
  time -p dd if=/dev/zero of=$i.tmp bs=1024k count=1024
done

lfs getstripe *
# will see that each file has multiple odbidx number
# indicating striping w/in a single file

</PRE>




<H5>Method 2: Geek testing </H5>

Terascala created some script that create a series of directories at the top level of the lustre file system,
where by diff dir would mean writting data with differnt stripping patters.


<PRE>

# login to lustre server (eg mds1)
cd /root/bin/misc/clients
./setup_directories


The above will result in dirs that are:

/mnt/lustre/ost
	ost-00      ost-01 ... ost-0n
	a series of ost dir, where files written to any of these dir will stay within each ost.
	This is good to benchmark to ensure all OST are performing equally.
	Test as root:
		for i in  /mnt/lustre/ost/ost* ; do
			time -p dd if=/dev/zero of=$i/dummy-file.tmp bs=1024k count=1024
		done


	lfs getstripe /mnt/lustre/ost/ost-00
	# will show obdidx all pointing to the same number 
	# (within each ost-0n dir)

/mnt/lustre/strip-xM
	# where x indicate stripe sizes. 1M maybe too small for optimal performance
	# 4M would be good starting point
	# different size dir are created so that 
	# performance against each of those can be done quickly



lfs getstripe *

</PRE>





<H2>compiling driver</H2>

kernel version specific.  It would be nice if they use DKMS so that the lustre module is automatically recompiled each time a new kernel is installed on the system.  <BR>
<BR>

patched kernel req on the server side (ie MDS, OST), but not needed on client side (ie compute node mounting lustre fs). <BR>
<BR>

To compile lustre module, the 'quilt' tool is helpful.  <BR>
<BR>


<PRE>
</PRE>

<H2>Server side</H2>

<H3>Config</H3>
<OL>
<LI>MDS are metadata server, typically one is enough, as it is only to check file path info.  1 second standby maybe useful in HA.  lustre ost are not cluster-based, thus the other node is standby and not active-active ??
<LI>OST: these are the file/data block servers.  As many as needed to control the disks shelves and provide performance.
Terascala make these in HA active/standby pair also on Dell hardware.

</OL>

<H3>start up</H3>

<PRE>
/etc/init.d/tslagent start

</PRE>

<H3>cmd</H3>

<PRE>
ts 		# similar to tentakel or gsh , run command on all server nodes

for i in 1 2 3 4 5 6; do ts $i echo ======= \; hostname\; mount ; done


</PRE>

<H3>Ref/Links</H3>
<UL>
<LI>http://wiki.whamcloud.com/display/PUB/Documentation
</UL>


<BR><BR>
<HR>
<BR><BR>



<A NAME="cc"></A>
<A NAME="CreativeCommon"></A>
<H3>Copyright info about this work
</H3>    

<p>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Creative Commons Attribution-NonCommercial-ShareAlike2.5 License</a>.
       <!--/Creative Commons License-->
       <!-- <rdf:RDF xmlns="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
       <Work rdf:about="">
       <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
            <dc:title>Pocket Sys Admin Survival Guide</dc:title>
            <dc:date>2005</dc:date>
            <dc:description>A series of concise system administration notes</dc:description>
            <dc:creator><Agent><dc:title>Tin Ho</dc:title></Agent></dc:creator>
            <dc:rights><Agent><dc:title>Tin Ho</dc:title></Agent></dc:rights>
            <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
            <dc:source rdf:resource="http://psg.ask-margo.com/" />
            </Work>
            <License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.5/"><permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
                                       <permits rdf:resource="http://web.resource.org/cc/Distribution"/>
                                       <requires rdf:resource="http://web.resource.org/cc/Notice"/><requires rdf:resource="http://web.resource.org/cc/Attribution"/>
                                       <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse"/>
                                       <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks"/><requires rdf:resource="http://web.resource.org/cc/ShareAlike"/>
            </License>
            </rdf:RDF> -->


<Strong>Pocket Sys Admin Survival Guide</Strong>: for content that I wrote, (<a
 href="http://creativecommons.org/licenses/by-nc-sa/2.5/">CC</a>)  
 <a href="http://creativecommons.org/learnmore"> <i>some rights reserved</i></a>.  
 2005,2012 Tin Ho [ tin6150 (at) gmail.com ]  <br>
 
Some contents are "cached" here for easy reference. Sources include man pages, 
vendor documents, online references, discussion groups, etc. Copyright of those 
are obviously those of the vendor and original authors.  I am merely caching them here for quick reference and avoid broken URL problems.
</p>

  <br><br>


<h3>Where is PSG hosted these days?</h3>
  <div id="psg-url">
  <a href="http://tin6150.github.io/psg/psg2.html">http://tin6150.github.io/psg/psg2.html</a> 
  This new home page at github<br>
  
  <A HREF="http://tiny.cc/tin6150"> 
  http://tiny.cc/tin6150/</A>
  New home in 2011.06.  <BR>

  <A HREF="http://tiny.cc/tin6150a"> 
  http://tiny.cc/tin6150a/</A>
  Alt home in 2011.06.  <BR>


<A HREF="http://tin6150.s3-website-us-west-1.amazonaws.com/psg.html">http://tin6150.s3-website-us-west-1.amazonaws.com/psg.html</A> 
(won't be coming after all)

<BR>
<a href="ftp://read:only@sn.is-a-geek.com/psg/psg.html">ftp://sn.is-a-geek.com/psg/psg.html</a> 
My home "server".  Up sporadically.
<BR>

<!--
Other caches in decreasing order of update frequency:  <BR>

<A HREF="http://tin6150.github.io/psg/psg.html">
http://tin6150.github.io/psg/psg.html
</A> 
(Google site, they are changing their policy and I may not be update these pages in the near future.  Last updated 2009-10-10)<BR>
-->


<A HREF="http://psg.ask-margo.com/psg.html">http://psg.ask-margo.com/psg.html</A> <BR>
<A HREF="http://www.fiu.edu/~tho01/psg/psg.html">http://www.fiu.edu/~tho01/psg/psg.html</A> (no longer updated as of 2007-05)<BR>

</div>       
      
      
      
      
      
      
      
      
      
      
      
      
  </div> <!-- #content -->
  
  
  <div id="tailer">      
            <div class="noicon">
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">
                <img alt="Creative Commons License" src="http://creativecommons.org/images/public/somerights20.png"></a>
            <a href="http://jigsaw.w3.org/css-validator/check/referer">
                <img style="border:0;width:88px;height:31px"
                    src="http://jigsaw.w3.org/css-validator/images/vcss-blue"
                    alt="Valid CSS!">
            </a>
            <a href="http://validator.w3.org/check?uri=referer">
                <img src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01 Strict" height="31" width="88">
            </a>
        </div>
  </div> <!-- #tailer -->

  
  
  
  
  <div id="footer"> (CC 2012) Some Rights Reserved.</div>
  
</div> <!-- closes wrapper --> 
</body>
</html>
